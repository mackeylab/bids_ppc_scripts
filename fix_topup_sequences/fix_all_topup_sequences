#/bin/bash

#this script goes through the BIDS directory and splits out just the b=0 volume from the TOPUP scan and the last volume from the DWI scan for use in TOPUP
for sub in
do
sub=sub-CBPD0173
ses=ses-01

fieldmap_orig=fmap/sub-CBPD0173_ses-01_run-01_epi.nii.gz
echo ${fieldmap_orig}
topup_jpos=fmap/${sub}_${ses}_dir-PA_run-01_epi.nii.gz
topup_jneg=fmap/${sub}_${ses}_dir-AP_run-01_epi.nii.gz
#the fieldmap is acquired in the j direction
3dcalc -a ${fieldmap_orig}[0] -expr '1*a' -prefix ${topup_jpos}
#the dwi scan is acquired in the -j direction, take the last scan of the dwi, which is b=0, before TOPUP
dwi=dwi/sub-CBPD0173_ses-01_run-01_dwi.nii.gz
3dcalc -a ${dwi}[$] -expr '1*a' -prefix ${topup_jneg}


rm ${sub}*.bval
rm ${sub}*.bvec
rm ${fieldmap_orig}

done
